import{b as K,v as ie,u as j,w as G,o as ce,a$ as oe,i as e,d as l,b0 as Q,S as L,t as m,b1 as de,c as Y,B as D,F as A,b2 as ue,p as ee,b3 as $,ac as ge,L as g,ag as R,b4 as pe,b5 as be,b6 as he,b7 as ve,b8 as fe,b9 as me,ba as xe,bb as _e,bc as $e,bd as Ce,h as ke,be as ye,bf as O,bg as W,bh as Se,bi as we,a_ as Ee,bj as De,bk as Z,bl as Le,bm as J,bn as Te,bo as Ie,bp as Ne,bq as Pe,br as Ae,f as Fe,bs as Be}from"./index-B3l_s7jA.js";import{z as y,c as le,v as te}from"./index-Cax71549.js";import{C as S}from"./ConfigTitle-UIgRQej0.js";var Re=m('<div class="flex flex-col p-4">'),je=m('<div class="flex flex-col"><form class="flex gap-2 sm:flex-row"><input type=search name=name class="input input-bordered min-w-0 flex-1"placeholder=google.com><div class="flex items-center gap-2"><select name=type class="select select-bordered"><option>A</option><option>AAAA</option><option>MX'),Oe=m("<div class=py-2>"),Me=m('<form class="grid grid-cols-3 gap-2 sm:grid-cols-5">'),Qe=m('<div class="grid grid-cols-2 gap-2 sm:grid-cols-4"><div class=form-control><label for=enable-allow-lan class="label gap-2"><span class=label-text></span></label><input id=enable-allow-lan type=checkbox class=toggle></div><div class=form-control><label for=enable-tun-device class="label gap-2"><span class=label-text></span></label><input id=enable-tun-device type=checkbox class=toggle></div><div class=form-control><label for=tun-ip-stack class="label gap-2"><span class=label-text></span></label><select id=tun-ip-stack class="select select-bordered flex-1"><option>Mixed</option><option>gVisor</option><option>System</option><option>LWIP</option></select></div><div class=form-control><label for=device-name class="label gap-2"><span class=label-text></span></label><input id=device-name class="input input-bordered min-w-0"></div><div class=form-control><label for=interface-name class="label gap-2"><span class=label-text></span></label><input id=interface-name class="input input-bordered min-w-0">'),Ge=m('<div class="flex flex-col gap-4"><select class="select select-bordered"><option></option><option></option><option></option></select><div class="grid grid-cols-2 gap-2 sm:grid-cols-3">'),Ue=m('<div class=form-control><label class=label><span class=label-text></span></label><input type=number class="input input-bordered">'),qe=m('<div class="flex flex-col gap-2"><div class="flex flex-col"><select class="select select-bordered"></select></div><div class="flex flex-col"><select class="select select-bordered">'),Ve=m('<div class="grid grid-cols-1 gap-4 sm:grid-cols-2"><div class="flex flex-col gap-2"><div class="flex flex-col items-center"><input type=checkbox class=toggle></div><div class="flex flex-col"><select class="select select-bordered"></select></div></div><div class="flex flex-col gap-2"><div class="flex flex-col items-center"><input type=checkbox class=toggle>'),M=m("<option>"),ze=m('<span class="absolute -right-1 -top-1 flex h-3 w-3"><span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-info opacity-75"></span><span class="inline-flex h-3 w-3 rounded-full bg-info">'),He=m('<div class="grid grid-cols-2 gap-4"><kbd class=kbd></kbd><div class=relative><kbd class="kbd w-full">'),Xe=m('<div class="mx-auto flex max-w-screen-md flex-col gap-4">');const We=y.object({name:y.string(),type:y.string()}),Ze=()=>{const[d]=j(),t=de(),{form:v,isSubmitting:b}=le({extend:te({schema:We}),onSubmit:h=>t.get("dns/query",{searchParams:{name:h.name,type:h.type}}).json().then(({Answer:s})=>C((s==null?void 0:s.map(({data:c})=>c))||[])).catch(s=>Fe.error(s.message))}),[r,C]=G([]);return(()=>{var h=je(),s=h.firstChild,c=s.firstChild,n=c.nextSibling;return n.firstChild,Y(v,s,()=>v),e(n,l(D,{type:"submit",class:"btn-primary",get loading(){return b()},get children(){return d("dnsQuery")}}),null),e(h,l(L,{get when(){return r().length>0},get children(){var _=Re();return e(_,l(A,{get each(){return r()},children:o=>(()=>{var p=Oe();return e(p,o),p})()})),_}}),null),h})()},Je=y.object({port:y.number(),"socks-port":y.number(),"redir-port":y.number(),"tproxy-port":y.number(),"mixed-port":y.number()}),Ke=({backendVersion:d})=>{const[t]=j(),v=K(),b=[{label:()=>t("port",{name:"HTTP"}),key:"port",onChange:n=>void $("port",Number(n.target.value),c)},{label:()=>t("port",{name:"Socks"}),key:"socks-port",onChange:n=>void $("socks-port",Number(n.target.value),c)},{label:()=>t("port",{name:"Redir"}),key:"redir-port",onChange:n=>void $("redir-port",Number(n.target.value),c)},{label:()=>t("port",{name:"TProxy"}),key:"tproxy-port",onChange:n=>void $("tproxy-port",Number(n.target.value),c)},{label:()=>t("port",{name:"Mixed"}),key:"mixed-port",onChange:n=>void $("mixed-port",Number(n.target.value),c)}],{form:r,setInitialValues:C,reset:h}=le({extend:te({schema:Je})}),[s,{refetch:c}]=ue(Be);return ee(()=>{const n=s();n&&(C(n),h())}),(()=>{var n=Ge(),_=n.firstChild,o=_.firstChild,p=o.nextSibling,w=p.nextSibling,k=_.nextSibling;return _.addEventListener("change",u=>void $("mode",u.target.value,c)),e(o,()=>t("global")),e(p,()=>t("rule")),e(w,()=>t("direct")),e(n,l(L,{get when(){return!Q(d())},get children(){return[(()=>{var u=Me();return Y(r,u,()=>r),e(u,l(A,{each:b,children:i=>(()=>{var f=Ue(),T=f.firstChild,F=T.firstChild,E=T.nextSibling;return e(F,()=>i.label()),ge(E,"change",i.onChange),g(x=>{var B=i.key,I=i.key,N=i.key,P=i.label();return B!==x.e&&R(T,"for",x.e=B),I!==x.t&&R(E,"id",x.t=I),N!==x.a&&R(E,"name",x.a=N),P!==x.o&&R(E,"placeholder",x.o=P),x},{e:void 0,t:void 0,a:void 0,o:void 0}),f})()})),u})(),(()=>{var u=Qe(),i=u.firstChild,f=i.firstChild,T=f.firstChild,F=f.nextSibling,E=i.nextSibling,x=E.firstChild,B=x.firstChild,I=x.nextSibling,N=E.nextSibling,P=N.firstChild,ae=P.firstChild,U=P.nextSibling,q=N.nextSibling,V=q.firstChild,ne=V.firstChild,z=V.nextSibling,re=q.nextSibling,H=re.firstChild,se=H.firstChild,X=H.nextSibling;return e(T,()=>t("allowLan")),F.addEventListener("change",a=>void $("allow-lan",a.target.checked,c)),e(B,()=>t("enableTunDevice")),I.addEventListener("change",a=>void $("tun",{enable:a.target.checked},c)),e(ae,()=>t("tunModeStack")),U.addEventListener("change",a=>void $("tun",{stack:a.target.value},c)),e(ne,()=>t("tunDeviceName")),z.addEventListener("change",a=>void $("tun",{device:a.target.value},c)),e(se,()=>t("interfaceName")),X.addEventListener("change",a=>void $("interface-name",a.target.value,c)),g(()=>{var a;return F.checked=(a=s())==null?void 0:a["allow-lan"]}),g(()=>{var a;return I.checked=(a=s())==null?void 0:a.tun.enable}),g(()=>{var a;return U.value=(a=s())==null?void 0:a.tun.stack}),g(()=>{var a;return z.value=(a=s())==null?void 0:a.tun.device}),g(()=>{var a;return X.value=(a=s())==null?void 0:a["interface-name"]}),u})()]}}),k),e(k,l(D,{class:"btn-primary",get loading(){return pe()},onClick:be,get children(){return t("reloadConfig")}}),null),e(k,l(D,{class:"btn-secondary",get loading(){return he()},onClick:ve,get children(){return t("updateGEODatabases")}}),null),e(k,l(D,{class:"btn-accent",get loading(){return fe()},onClick:me,get children(){return t("flushFakeIP")}}),null),e(k,l(L,{get when(){return!Q(d())},get children(){return l(D,{class:"btn-error",get loading(){return xe()},onClick:_e,get children(){return t("upgradeCore")}})}}),null),e(k,l(D,{class:"btn-warning",get loading(){return $e()},onClick:Ce,get children(){return t("restartCore")}}),null),e(k,l(D,{class:"btn-info",onClick:()=>{ke(""),v(ye.Setup)},get children(){return t("switchEndpoint")}}),null),g(()=>{var u;return _.value=(u=s())==null?void 0:u.mode}),g(()=>o.value=O.Global),g(()=>p.value=O.Rule),g(()=>w.value=O.Direct),n})()},Ye=()=>{const[d]=j(),t=[{label:()=>d("en"),value:W.EN},{label:()=>d("zh"),value:W.ZH}];return(()=>{var v=Ve(),b=v.firstChild,r=b.firstChild,C=r.firstChild,h=r.nextSibling,s=h.firstChild,c=b.nextSibling,n=c.firstChild,_=n.firstChild;return e(r,l(S,{get children(){return d("useTwemoji")}}),C),C.addEventListener("change",o=>Se(o.target.checked)),e(h,l(S,{get children(){return d("switchLanguage")}}),s),s.addEventListener("change",o=>we(o.target.value)),e(s,l(A,{each:t,children:o=>(()=>{var p=M();return e(p,()=>o.label()),g(()=>p.selected=Ee()===o.value),g(()=>p.value=o.value),p})()})),e(n,l(S,{get children(){return d("autoSwitchTheme")}}),_),_.addEventListener("change",o=>De(o.target.checked)),e(c,l(L,{get when(){return Z()},get children(){var o=qe(),p=o.firstChild,w=p.firstChild,k=p.nextSibling,u=k.firstChild;return e(p,l(S,{get children(){return d("favDayTheme")}}),w),w.addEventListener("change",i=>Le(i.target.value)),e(w,l(A,{each:J,children:i=>(()=>{var f=M();return f.value=i,e(f,i),f})()})),e(k,l(S,{get children(){return d("favNightTheme")}}),u),u.addEventListener("change",i=>Te(i.target.value)),e(u,l(A,{each:J,children:i=>(()=>{var f=M();return f.value=i,e(f,i),f})()})),g(()=>w.value=Ie()),g(()=>u.value=Ne()),o}}),null),g(()=>C.checked=Pe()),g(()=>_.checked=Z()),v})()},el=({backendVersion:d})=>{const[t,v]=G(!1);return ee(async()=>{const b=d();b&&v(await Ae(b))}),(()=>{var b=He(),r=b.firstChild,C=r.nextSibling,h=C.firstChild;return e(r,()=>"1.140.0"),e(C,l(L,{get when(){return t()},get children(){return ze()}}),h),e(h,d),b})()},nl=()=>{const d=K();if(!ie())return d("/setup",{replace:!0}),null;const[t]=j(),[v,b]=G("");return ce(async()=>{b(await oe())}),(()=>{var r=Xe();return e(r,l(L,{get when(){return!Q(v())},get children(){return[l(S,{withDivider:!0,get children(){return t("dnsQuery")}}),l(Ze,{})]}}),null),e(r,l(S,{withDivider:!0,get children(){return t("coreConfig")}}),null),e(r,l(Ke,{backendVersion:v}),null),e(r,l(S,{withDivider:!0,get children(){return t("xdConfig")}}),null),e(r,l(Ye,{}),null),e(r,l(S,{withDivider:!0,get children(){return t("version")}}),null),e(r,l(el,{backendVersion:v}),null),r})()};export{nl as default};
